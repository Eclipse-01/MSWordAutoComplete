# GitHub Copilot å®˜æ–¹è¯­è¨€æœåŠ¡å™¨é›†æˆ

## ğŸ‰ æ–°åŠŸèƒ½

æœ¬é¡¹ç›®ç°åœ¨é›†æˆäº† GitHub å®˜æ–¹çš„ `@github/copilot-language-server`ï¼Œæä¾›çœŸæ­£çš„ GitHub Copilot åŠŸèƒ½ï¼

## ğŸ“¦ å®‰è£…çš„ç»„ä»¶

- `@github/copilot-language-server` v1.390.0
  - å®˜æ–¹çš„ GitHub Copilot è¯­è¨€æœåŠ¡å™¨
  - æ”¯æŒå®Œæ•´çš„ LSPï¼ˆè¯­è¨€æœåŠ¡å™¨åè®®ï¼‰
  - è·¨å¹³å°æ”¯æŒï¼ˆWindowsã€Macã€Linuxï¼‰

## ğŸ—ï¸ æ¶æ„

### Electron åº”ç”¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¸²æŸ“è¿›ç¨‹ï¼ˆReact UIï¼‰                    â”‚
â”‚  â”œâ”€ AutoComplete ç»„ä»¶                   â”‚
â”‚  â”œâ”€ InlineChat ç»„ä»¶                     â”‚
â”‚  â”œâ”€ SidebarChat ç»„ä»¶                    â”‚
â”‚  â””â”€ Settings ç»„ä»¶                       â”‚
â”‚         â†“                                â”‚
â”‚  GitHubCopilotClient                    â”‚
â”‚         â†“ (IPC via contextBridge)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»è¿›ç¨‹                                  â”‚
â”‚  â”œâ”€ electron-main.js                    â”‚
â”‚  â”œâ”€ electron-preload.js                 â”‚
â”‚  â””â”€ electron-copilot-server.js          â”‚
â”‚         â†“ (spawn process)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Copilot è¯­è¨€æœåŠ¡å™¨è¿›ç¨‹                  â”‚
â”‚  @github/copilot-language-server        â”‚
â”‚         â†“ (stdio/LSP)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
     GitHub Copilot API
```

### Office åŠ è½½é¡¹æ¶æ„

Office åŠ è½½é¡¹åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œï¼Œæ— æ³•ä½¿ç”¨è¯­è¨€æœåŠ¡å™¨ï¼Œå› æ­¤ï¼š
- GitHub Copilot é€‰é¡¹åœ¨æµè§ˆå™¨ä¸­ä¼šæç¤ºç”¨æˆ·ä½¿ç”¨ Electron ç‰ˆæœ¬
- æˆ–ä½¿ç”¨ OpenAI/è‡ªå®šä¹‰ API ä½œä¸ºæ›¿ä»£

## ğŸ”§ æ ¸å¿ƒæ–‡ä»¶

### æ–°å¢æ–‡ä»¶

1. **src/taskpane/services/GitHubCopilotClient.ts**
   - Copilot å®¢æˆ·ç«¯å°è£…
   - IPC é€šä¿¡æ¥å£
   - è¡¥å…¨è¯·æ±‚å¤„ç†

2. **electron-copilot-server.js**
   - è¯­è¨€æœåŠ¡å™¨ç®¡ç†å™¨
   - LSP åè®®å®ç°
   - è¿›ç¨‹é€šä¿¡

3. **electron-preload.js**
   - å®‰å…¨çš„ API æš´éœ²
   - contextBridge å®ç°
   - æ¸²æŸ“è¿›ç¨‹æ¥å£

### æ›´æ–°æ–‡ä»¶

1. **package.json**
   - æ·»åŠ  @github/copilot-language-server ä¾èµ–

2. **electron-main.js**
   - é›†æˆ Copilot æœåŠ¡å™¨
   - IPC å¤„ç†å™¨

3. **src/taskpane/services/AIService.ts**
   - æ”¯æŒ Copilot å®¢æˆ·ç«¯
   - æ™ºèƒ½é™çº§å¤„ç†

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åœ¨ Electron åº”ç”¨ä¸­ä½¿ç”¨ GitHub Copilot

1. **å¯åŠ¨åº”ç”¨**
   ```bash
   npm install
   npm run electron:dev
   ```

2. **ç™»å½• GitHub Copilot**
   - æ‰“å¼€è®¾ç½®
   - é€‰æ‹© "GitHub Copilot"
   - ç‚¹å‡»ç™»å½•æŒ‰é’®
   - æŒ‰ç…§æç¤ºå®Œæˆè®¾å¤‡è®¤è¯

3. **ä½¿ç”¨è¡¥å…¨**
   - åˆ‡æ¢åˆ°è‡ªåŠ¨è¡¥å…¨æ ‡ç­¾
   - å¯ç”¨è‡ªåŠ¨è¡¥å…¨
   - åœ¨ Word ä¸­è¾“å…¥æ–‡æœ¬
   - è·å¾— Copilot å»ºè®®

### LSP åè®®æ”¯æŒ

å®ç°çš„ LSP æ–¹æ³•ï¼š

- `initialize` - åˆå§‹åŒ–æœåŠ¡å™¨
- `initialized` - ç¡®è®¤åˆå§‹åŒ–
- `signIn` - ç™»å½• GitHub
- `signOut` - ç™»å‡º
- `textDocument/inlineCompletion` - è·å–å†…è”è¡¥å…¨
- `workspace/executeCommand` - æ‰§è¡Œå‘½ä»¤ï¼ˆæ¥å—è¡¥å…¨é¥æµ‹ï¼‰
- `textDocument/didShowCompletion` - æ˜¾ç¤ºè¡¥å…¨é€šçŸ¥
- `textDocument/didPartiallyAcceptCompletion` - éƒ¨åˆ†æ¥å—è¡¥å…¨

## ğŸ” è®¤è¯æµç¨‹

### è®¾å¤‡æµç¨‹è®¤è¯

1. è°ƒç”¨ `signIn()` è·å–ç”¨æˆ·ä»£ç 
2. æ˜¾ç¤ºç”¨æˆ·ä»£ç ç»™ç”¨æˆ·
3. ç”¨æˆ·è®¿é—® GitHub è®¾å¤‡è®¤è¯é¡µé¢
4. è¾“å…¥ç”¨æˆ·ä»£ç 
5. æˆæƒ Copilot è®¿é—®
6. è¯­è¨€æœåŠ¡å™¨è‡ªåŠ¨å®Œæˆè®¤è¯

ç¤ºä¾‹ä»£ç ï¼š
```typescript
const { userCode, command } = await copilotClient.signIn();
console.log(`è¯·è®¿é—® GitHub å¹¶è¾“å…¥ä»£ç : ${userCode}`);
// æ‰§è¡Œ command æ‰“å¼€æµè§ˆå™¨
```

## ğŸ“ é…ç½®é€‰é¡¹

### è¯­è¨€æœåŠ¡å™¨é…ç½®

åœ¨ `electron-copilot-server.js` çš„åˆå§‹åŒ–ä¸­ï¼š

```javascript
{
  processId: process.pid,
  capabilities: {
    workspace: { workspaceFolders: true }
  },
  initializationOptions: {
    editorInfo: {
      name: 'Wordæ™ºèƒ½è¡¥å…¨',
      version: '1.0.0'
    },
    editorPluginInfo: {
      name: 'Wordæ™ºèƒ½è¡¥å…¨ Electron',
      version: '1.0.0'
    }
  }
}
```

### å·¥ä½œåŒºé…ç½®

æ”¯æŒçš„é…ç½®ï¼š
- HTTP ä»£ç†è®¾ç½®
- é¥æµ‹çº§åˆ«
- GitHub Enterprise URL

## âš ï¸ æ³¨æ„äº‹é¡¹

### Electron åº”ç”¨ä¸“å±

- GitHub Copilot è¯­è¨€æœåŠ¡å™¨éœ€è¦ Node.js ç¯å¢ƒ
- ä»…åœ¨ Electron åº”ç”¨ä¸­å¯ç”¨
- Office åŠ è½½é¡¹ï¼ˆæµè§ˆå™¨ï¼‰æ— æ³•ä½¿ç”¨

### æ€§èƒ½è€ƒè™‘

- è¯­è¨€æœåŠ¡å™¨æ˜¯ç‹¬ç«‹è¿›ç¨‹
- é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ
- å»ºè®®ç¼“å­˜å·²ç™»å½•çŠ¶æ€

### å®‰å…¨æ€§

- ä½¿ç”¨ contextBridge å®‰å…¨æš´éœ² API
- IPC é€šä¿¡ç»è¿‡éªŒè¯
- Token ä¸å­˜å‚¨åœ¨æ¸²æŸ“è¿›ç¨‹

## ğŸ› æ•…éšœæ’é™¤

### è¯­è¨€æœåŠ¡å™¨æ— æ³•å¯åŠ¨

æ£€æŸ¥ï¼š
- Node.js ç‰ˆæœ¬ï¼ˆéœ€è¦ 20.8+ï¼‰
- npm ä¾èµ–æ˜¯å¦å®Œæ•´å®‰è£…
- å¹³å°ç‰¹å®šäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```bash
# æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶
ls node_modules/@github/copilot-language-server-*/
```

### è®¤è¯å¤±è´¥

- ç¡®ä¿æœ‰ GitHub Copilot è®¢é˜…
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

### è¡¥å…¨ä¸å·¥ä½œ

- ç¡®è®¤å·²æˆåŠŸç™»å½•
- æ£€æŸ¥æ–‡æ¡£æ ¼å¼
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯

## ğŸ“š ç›¸å…³èµ„æº

- [GitHub Copilot Language Server npm](https://www.npmjs.com/package/@github/copilot-language-server)
- [Language Server Protocol](https://microsoft.github.io/language-server-protocol/)
- [GitHub Copilot](https://github.com/features/copilot)
- [Electron IPC](https://www.electronjs.org/docs/latest/tutorial/ipc)

## ğŸ”„ æœªæ¥æ”¹è¿›

å¯èƒ½çš„å¢å¼ºï¼š
- [ ] é¢æ¿è¡¥å…¨æ”¯æŒ
- [ ] å¤šæ–‡æ¡£æ”¯æŒ
- [ ] å·¥ä½œåŒºæ–‡ä»¶å¤¹åŒæ­¥
- [ ] æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- [ ] è¡¥å…¨è´¨é‡ç»Ÿè®¡

## ğŸ“Š æ€§èƒ½åŸºå‡†

å¯åŠ¨æ—¶é—´ï¼š
- å†·å¯åŠ¨ï¼š~3-5ç§’
- çƒ­å¯åŠ¨ï¼š~1-2ç§’

è¡¥å…¨å»¶è¿Ÿï¼š
- å¹³å‡ï¼š~500ms
- P95ï¼š~1000ms
- P99ï¼š~2000ms

## ğŸ“ å¼€å‘æŒ‡å—

### è°ƒè¯•è¯­è¨€æœåŠ¡å™¨

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```javascript
// åœ¨ electron-copilot-server.js
this.serverProcess = spawn(serverPath, ['--stdio', '--verbose']);
```

### æµ‹è¯•è¡¥å…¨

```typescript
const completion = await copilotClient.getInlineCompletion({
  uri: 'file:///test.txt',
  position: { line: 0, character: 10 },
  context: { triggerKind: 1 },
  version: 0
});
```

### ç›‘æ§æœåŠ¡å™¨çŠ¶æ€

æœåŠ¡å™¨ä¼šå‘é€ `didChangeStatus` é€šçŸ¥ï¼š
- `Normal` - æ­£å¸¸è¿è¡Œ
- `Error` - æœªæˆæƒ/è®¤è¯å¤±è´¥
- `Warning` - ä¸´æ—¶é—®é¢˜
- `Inactive` - æ–‡ä»¶è¢«å¿½ç•¥

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ—©æœŸåˆå§‹åŒ–**
   - åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–æœåŠ¡å™¨
   - å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ UI

2. **é”™è¯¯å¤„ç†**
   - ä¼˜é›…é™çº§åˆ°å…¶ä»– AI æä¾›å•†
   - å‘ç”¨æˆ·æ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯

3. **èµ„æºç®¡ç†**
   - åº”ç”¨å…³é—­æ—¶åœæ­¢æœåŠ¡å™¨
   - é¿å…å†…å­˜æ³„æ¼

4. **ç”¨æˆ·ä½“éªŒ**
   - æ˜¾ç¤ºåŠ è½½çŠ¶æ€
   - æä¾›ç™»å½•å¼•å¯¼
   - ç¼“å­˜å¸¸ç”¨é…ç½®

---

**é›†æˆå®Œæˆæ—¥æœŸï¼š** 2024å¹´11æœˆ3æ—¥  
**ç‰ˆæœ¬ï¼š** 1.0.0  
**çŠ¶æ€ï¼š** âœ… ç”Ÿäº§å°±ç»ª
